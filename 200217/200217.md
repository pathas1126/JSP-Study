# 200217

## 복습

### 웹 서버

> 클라이언트의 요청을 받아서 처리한 후 결과를 클라이언트에 전송해 주는 객체

- Request: 웹 클라이언트 → 웹 서버
- Response: 웹 서버 → 웹 클라이언트

*※ 클라이언트 - 서버 소통은 HTTP 프로토콜을 통해 이루어짐*

### 모델

- 모델 1: 소규모, 중소규모 사이트
- 모델 2: 대규모 사이트, 서블릿 사용, Spring

### URL

http://localhost:6060/JspStudy/hello.jps
프로토콜://접속 도메인:접속 포트/접속 프로젝트/문서.jsp

---

# JSP

> Java Server Page
> HTML과 Directives가 혼합된 문서 형태

## JSP 요청 처리 과정

1. 웹 클라이언트에서 jsp 파일 요청
2. 서버에서 서블릿 컨테이너 검색
3. 서블릿 객체가 없다면 JSP 파일을 자동 컴파일
   JSP파일을 서블릿을 위한 자바파일(.java)로 변경하고
   자바 코드를 서블릿 클래스로 컴파일
4. 컴파일된 서블릿 파일을 클라이언트에 응답

*※ 결국 jsp도 서블릿으로 만들어짐*

## JSP 3대 Script 요소

| 요소                   | 형식         | 목적                            |
| ---------------------- | ------------ | ------------------------------- |
| *Scriptlet 스크립트릿* | **< % % >**  | 프로그래밍 코드(Java code) 기술 |
| *Expression 표현식*    | **< %= %>**  | 화면에 출력할 내용 기술         |
| *Declaration 선언문*   | **< %! % >** | 전역 변수 선언 및 메소드 선언   |

### ① ScriptLet

> ScriptLet(스크립트릿): 웹 상에서 자바코드를 사용할 수 있도록 하는 영역

1. **< % Java Code % >**: < & & > 내부에 자바 코드 작성, 주석도 작성 가능
2. JavaScript 구문이 아니기 때문에 태그 및 표현식 작성 불가
3. JSP 내부 어디든 선언해서 사용 가능
   단, page Directive 위에 다른 스크립트릿을 사용해서는 안 됨
4. 순차적으로 실행됨
   head 태그 내부에는 스크립트릿으로 변수를 선언하고
   body 태그 내부의 스크립트릿에서 변수 사용 가능
   *→ 순차적으로 실행되기 때문에 사용할 변수를 나중에 선언할 수는 없음*
5. 변수(지역 변수)를 선언하거나 간단한 제어문을 쓸 때 사용

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%
	// 변수 선언
	int count = 3;
%>
</head>
<body>
	<%
		// 웹 페이지에 출력을 수행하는 반복문
		for (int i = 0; i < count; i++) {
			out.println("<h1>JSP 테스트" + i + "</h1><br/>");
		}
		out.print("count: " + count);
	%>
    <!--
	JSP 테스트0
	JSP 테스트1
	JSP 테스트2
	count: 3
	-->
</body>
</html>
```

### ②  Expression 표현식

> 출력문 대용으로 간단하게 사용

- **< %=JavaCode% >**
  스크립트릿 내부에 = 기호가 추가됨
- 변수값 출력, 메서드 호출시 사용
  < %=변수명% >, < %=객체명.일반메소드명(~) % >, < %=정적메소드명.(~)% >
- 표현식 내부에는 ;(세미콜론)을 작성하지 않음
- 스크립트릿 내부에는 표현식 작성 불가
- 출력문 대용이기 때문에 웹 페이지에 출력됨

```jsp
<%@page import="com.sun.org.apache.xalan.internal.xsltc.compiler.Output"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%
	// 변수 선언
	int count = 3;
%>
</head>
<body>
    <!-- 표현식 작성 -->
	<%=count%>
	<%=count%>
	<%=count%>
    <!-- 3 3 3 -->
</body>
</html>
```

### ③ Declaration 선언문

- < %!JavaCode% >, 스크립트릿에 !(느낌표)가 추가됨
- 전역 변수, 메소드 선언시 사용
- **선언된 위치에 상관없이 변수를 불러다 사용 가능**
- 일반적으로 메소드는 다른 파일에 작성해서 분리함(JavaBean)
  같이 작성할 경우 기능과 디자인이 섞여서 보기도 안 좋고 충돌 가능성이 있음

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%=sum(5, 3)%>
    <!-- 8 -->
    
	<%=count%>
	<!-- 3 -->
    
	<%!
    // 변수 선언
	int count = 3;
    
    // 메소드 선언
	public int sum(int a, int b) {
		return a + b;
	}%>
</body>
</html>
```

*※ JavaBean*
*DTO(Data Transfer Object): Setter, Getter*
*DAO(Data Access Object): 웹 상에서 DB에 관련된 메소드만 선언된 클래스*

## comment 주석

- **<%-- --%>**: JSP 주석, 페이지 '소스 보기'에서 주석 확인 불가, 개발자만 확인 가능
- **<!-- -->**: HTML 주석, '소스 보기'에서 주석 확인 가능, 클라이언트도 확인 가능
- **//, /* */**: Java 주석, 스크립트릿, 표현식, 선언문 내부에 사용
- HTML 주석 내부에 표현식 사용 가능
  ***스크립트릿은 사용 불가!!***

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<!-- HTML 주석 -->
<%-- JSP 주석 --%>
<head>
<meta charset="UTF-8">
<title>JSP Comment</title>
</head>
<!-- 5+3 <%=5+3%> -->
<%/* 주석 내부에 표현식을 작성하는 경우
소스 보기에서 8이 출력된 것을 볼 수 있음*/%>
<body bgcolor="yellow">
	<h1> JSP 주석 확인 예제</h1>
</body>
</html>
```

*※ HTTP 상태 500 에러*
*문법이 잘 못된 경우 발생하는 에러*
*html 주석 내부에 스크립트릿을 작성했을 때도 발생*

## 종합 예제_표 만들기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%!
// 문자열 배열 선언
String[] keyword = { "Scriptlet", "Expression", "Declaration" };
%>
</head>
<body>
<!-- table 태그는 하나만 있으면 되므로 for문 밖에 작성 -->
	<table border="1px solid black" width="200">
		<%
			// tr, td를 for문을 통해서 생성 
			for (int i = 0; i < keyword.length; i++) {
				out.println("<tr><td>" + i + "</td><td class='td2'>" + keyword[i] + "</td></tr>");
			}
		%>
	</table>
    <!--
	0 Scriptlet
	1 Expression
	2 Declaration		
	 -->
</body>
</html>
```

## 웹 애플리케이션 배포 _ WAR 내보내기

> WAR: Web ARchive로 웹 애플리케이션을 구성하는 파일들을 포함하는 파일
>
> 웹 애플리케이션을 완성한 후 서비스하기 위해서는
> 반드시 WAR파일을 만들어야 함

### WAR 파일 생성

1. 서버 실행 종료
2. 배포를 원하는 프로젝트 우클릭
3. Export → WAR file
4. Destination: 저장 경로 지정
5. Export source files: 자바 파일을 같이 내보낼 것인지 선택
6. Overwrite existing file: 이미 존재하는 WAR 파일이 있는 경우 덮어쓸 것인지 선택
7. Finish

### WAR 파일 불러오기

1. Project Explorer 우클릭
2. Import → WAR Import
3. WAR file: WAR 파일 경로 지정
4. Web project: 프로젝트명 지정, 프로젝트명이 중복되는 경우 충돌
5. Taget runtime: 런타임 서버 선택
6. Finish

---

# Request 내장 객체

## JSP 웹 프로그래밍 기본 구조

> 한 파일에서 모든 작업을 할 수 없기 때문에
> 요청을 하는 페이지와 요청을 처리해서 응답하는 페이지로 분리함

- 요청 페이지: 요청을 입력받는 페이지로 로그인이나 회원가입 페이지가 포함됨
  html 또는 jsp 파일
- 응답 페이지: 해당 요청을 처리한 뒤 요청 페이지로 응답을 보내는 페이지, jsp 파일
- 이클립스에서 작업시, 파일 우클릭 → Open with → Web Page Editor
  를 사용하면 작업 내용을 실시간으로 확인할 수 있음

## Request

> 웹 브라우저에서 JSP 페이지로 전달되는 정보의 모임

- HTTP 헤더와 HTTP 바디로 구성
- 웹 컨테이너가 요청된 HTTP 메세지를 통해 HttpServletRequest 객체를 얻어냄
- JSP 페이지에서는 HttpServletRequest 객체를 request 객체명으로 사용

### request Method

> 사용자가 form에 입력한 요구 사항을 얻어낼 수 있도록하는 메소드 제공

| 메소드                              | 설명                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| *String getParameter(name)*         | 파라미터 변수 name에 저장된 값을 얻어내는 메소드<br />해당 변수명이 없으면 null 리턴<br />단독값을 입력하는 text, select, radio 등에 사용 |
| *String[] getParameterValues(name)* | 파라미터 변수 name에 저장된 모든 값을 얻어내는 메소드<br />변수값은 String 배열로 리턴<br />다중값을 입력하는 checkbox 등에 사용 |
| *Enumeration getPrameterNames()*    | 요청에 의해 넘어오는 모든 파라미터 변수를 java.util.Enumeration 타입으로 리턴<br />변수가 가진 객체들을 저장하기 위해 Enumeration 컬렉션 사용 |

### < % request.setCharacterEncoding("utf-8"); % >

> ServletRequest 클래스 메소드

- void setCharacterEncoding(String env)
- 해당 request에 사용된 인코딩 방식을 env 인코딩으로 재정의함
- request 객체를 얻어오기 전에 작성해야 함
- request 메소드로 받아온 데이터의 한글이 깨지지 않도록 하기 위해서
  request 객체의 인코딩을 utf-8로 설정

### requset Method

> request 객체는 요청된 파라미터 값 외에도
> 웹 브라우저와 웹 서버의 정보도 가져올 수 있음

| 메소드                    | 설명                                                 |
| ------------------------- | ---------------------------------------------------- |
| *String getProtocol()*    | 웹 서버로 요청 시 사용 중인 프로토콜 리턴            |
| *String getServerName()*  | 서버의 도메인 이름 리턴                              |
| *String getMethod()*      | 요청에 사용된 요청 방식(GET, POST 등) 리턴           |
| *String getQueryString()* | 요청에 사용된 QueryString 리턴                       |
| *String getRequestURI()*  | 요청에 사용된 URL로부터 URI값 리턴                   |
| *String getRemoteHost()*  | 웹 서버로 정보를 요청한 웹 브라우저의 host 이름 리턴 |

| 메소드                             | 설명                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| *String getRemoteAddr() : String*  | 웹 서버로 정보를 요청한 웹 브라우저의 ip 주소 리턴           |
| *String getServerPort()*           | 웹 서버로 요청시 서버의 port 번호 리턴                       |
| *String getContextPath() : String* | 해당 JSP페이지가 속한 웹 애플리케이션의 콘텍스트 경로 리턴<br />콘텍스트 경로는 웹 애플리케이션의 루트 경로 |
| *String getHeader(name)*           | 웹 서버로 요청 시 HTTP 요청 header 이름인 name에 해당하는 속성값 리턴 |
| *Enumeration getHeaderNames()*     | HTTP 요청 header에 있는 모든 헤더 이름 리턴                  |

### URL & URI

- URL(Uniform Resource Locator)
  웹상에서 서비스를 제공하는 각 서버들이
  응답 시 전송하는 파일들의 위치를 명시하기 위한 것
  접속해야 할 서비스의 종류, 도메인명, 파일 위치 포함
- URI(Uniform Resource Identifier)
  URL로부터 존재하는 자원을 식별하기 위한 일반적인 식별자를 규정하는 것
  URL에서 HTTP 프로토콜, 호스트명, port 번호를 제외한 부분이 URI
- ex) URL: http://127.0.0.1:8080/study/ch04/requestTest1.jsp
  URI: study/ch04/requestTest1.jsp

## 예제

> html 파일에서 문자열과 숫자 데이터를 jsp파일로 넘겨 받아서
> 숫자만큼 문자열을 반복 출력하는 프로그램 작성

### WebContent/control/input.html

```html
<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>요청 페이지2</title>
</head>
<body>
    <!-- post 형식으로 while.jsp에 데이터 전달 -->
	<form method="post" action="../sub/while.jsp">
		반복할 문자열: <input type="text" name="msg" size="20"><br /> 반복할	숫자: <input type="text" name="number" size="20" /> <br />
		<input type="submit" value="보내기" />
	</form>
</body>
</html>
```

### WebContent/sub/while.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%
    	// 한글이 깨지지 않도록 처리
		request.setCharacterEncoding("utf-8");
	%>
	<%
    				// name 값이 msg인 매개변수 데이터를 가져옴
		String msg = request.getParameter("msg");
    
				 // name 값이 number인 매개변수 데이터를 가져옴
    	int num = Integer.parseInt(request.getParameter("number"));
    	
    	// number 만큼 반복 출력
		int i = 0;
		while (i < num) {
	%>
	<b><%=msg%></b><br/>
	<%
		i++;
		}
	%>
</body>
</html>
```

---

# JSP Page Directive

> 클라이언트가 요청한 JSP 페이지가 실행될 때
> 필요한 정보를 지정하는 역할을 함

- 필요한 정보를 JSP 컨테이너에 알려서 처리 방법을 지정하는 지시자
- 디렉티브는 태그 안에서 @로 시작
- page, include, taglib 등의 종류가 있음

## page Direvtive