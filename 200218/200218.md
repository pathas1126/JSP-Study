# 200218

## JavaScript in JSP

1. 링크에서 자바스크립트 코드 호출
   < a href="JavaScript:메소드()" >< /a >
2. 또는 이벤트 리스너 연결 ex) onclick="goBack()"
3. 버튼 클릭
   input type이 button인 경우에는 submit() 함수를 수동으로 작성
   submit인 경우에는 작성하지 않아도 됨
4. history.back() or history.go(-1) 메소드로
   이전 페이지로 이동하게 할 수 있음
5. window.open() 브라우저 대화창 띄우기
   window.close() 브라우저 닫기

## with

> 명령문의 스코프 체인을 확장해주는 구문
> 특정 객체를 여러 번 사용하는 경우 객체명을 생략할 수 있도록 도와줌

### 형식

```javascript
with(Expression){
    statement;
}
```

*※ Expression 객체의 이름은 생략하고 메소드나 변수명만 사용이 가능해짐*

### 예제

```javascript
let a, b, c;
let d = 5;

with(Math){
    a = d * random();
    b = d * PI;
    c = sqrt(d);
}

console.log(a);	// 2.5252127106198294
console.log(b);	// 15.707963267948966
console.log(c);	// 2.23606797749979
```

---

# JSP Page Directive

> 클라이언트가 요청한 JSP 페이지가 실행될 때 필요한 정보를 지정하는 역할을 함

- 필요한 정보를 JSP 컨테이너에 알려서 처리 방법을 지정하는 지시자
- 디렉티브는 태그 안에서 @로 시작
- page, include, taglib 등의 종류가 있음

## page Directive

- **< %@page % >**
- JSP 페이지에 대한 자세한 설정들을 속성을 사용해서 정의하는 디렉티브

## page Directive Properties

> JSP 페이지의 설정들을 정의하는 속성

| 속성명         | 기본값                         | 설명                                                         |
| -------------- | ------------------------------ | ------------------------------------------------------------ |
| *language*     | "java"                         | JSP 페이지의 스트립트 요소에서 사용할 언어를 지정하는 속성   |
| *contentType*  | "text/html;charset=ISO-8859-1" | JSP 페이지가 생성할 문서의 타입과 인코딩을 지정하는 속성     |
| *import*       |                                | 다른 패키지에 있는 클래스를 가져다 쓸 때 사용하는 속성       |
| *session*      | "true"                         | HttpSession의 사용 여부를 지정하는 속성                      |
| *pageEncoding* |                                | 해당 페이지의 문자 인코딩을 지정하는 속성                    |
| *isELIgnored*  |                                | 표현 언어(EL)에 대한 지원 여부를 설정하는 속성               |
| *buffer*       | "8kb"                          | JSP 페이지의 출력 버퍼 크기를 지정하는 속성                  |
| *autoflush*    | "true"                         | 출력 버퍼가 다 찰 경우 저장되어 있는 내용의 처리를 지정하는 속성<br />buffer와 함께 입출력, 액션태그와 연관 |
| *isThreadSafe* | "true"                         | 현재 페이지에 멀티 쓰레드의 허용 여부를 설정는 속성<br />관리자가 홈페이지를 보수해야 하는 경우에만 false 설정 |

- info 속성은 페이지 설명을 지정하는데 보통 주석으로 많이 사용
- erroPage, isErrorPage 속성은 에러페이지 작성시 사용하지만
  Tomcat 4.x까지만 사용했던 속성
- contentType의 기본값은 영어 인코딩이기 때문에
  한글 사용시 반드시 utf-8을 지정해야 함

## 예제

```jsp
<%@ 
	// JSP 페이지의 스크립트에서 사용할 언어는 Java
	page language="java"
        
    // JSP가 생성할 문서는 html이고 문자 인코딩은 UTF-8 형식
    contentType="text/html; charset=UTF-8"
        
    // 해당 페이지의 문자 인코딩을 UTF-8로 지정
    pageEncoding="UTF-8" 
        
    // Date 클래스를 사용하기 위해 java.util 패키지의 Date 클래스 import
    import="java.util.Date"
%>
```



---

# Servlet

> 서버 내부에서 실행되는 웹 프로그램
> 웹 브라우저로 실행 결과를 전송함
>
> ↔ JavaScript: 클라이언트에서 실행

- JSP 페이지를 요청하면 .jsp 파일이 .java 파일로 변환되는데
  변환된 자바 파일을 서블릿이라고 함
- .java 파일에 문제가 없다면 class 파일로 변환되어 메모리에 올라가게 됨
  서블릿 객체가 생성되며 요청에 따른 응답을 실행
- 자바 코드가 많이 사용되기 때문에 접근이 어려워서 JSP가 개발됨
- 요청에 바로 응답하기 때문에 jsp보다 속도가 빠름
- 모델 2에 사용되며 JSP와 적절하게 혼합해서 사용된다고 함

## Servlet 작성_in Eclipse

1. New → Servlet
   Class 파일로도 작성은 가능하지만
   Servlet으로 사용하기 위한 환경설정을 일일이 다 해주어야 함
2. Class name 작성
3. URL mappings: 서블릿 요청 경로 지정, 실행할 서블릿 클래스명과 동일함
   변경 시에는 xml파일 설정이 필요함, 모델 2(스프링) 환경설정 시 사용
   ex) /HelloTest
4. 필요에 따라 생성자 및 메소드 선택
5. 서블릿은 자바 파일이기 때문에 프로젝트의 src 폴더에 저장해야 함
   이클립스에서 볼 때는 Java Resources 폴더 내부에 src폴더가 있음

## Servlet 조건

- 서블릿, http 관련 클래스를 import 해야함
- 반드시 public class로 작성해야 함
  홈페이지에 누구나 접속이 가능하게 만들기 위함
- HttpServlet 클래스를 상속받아야 함
  doGet(), doPost() 등의 메소드를 사용하기 위함
  doGet(): 사용자가 GET으로 요청을 보냈을 때 자동으로 호출되는 메소드(콜백 계열)
  doPost(): POST로 요청 했을 때 자동으로 호출되는 메소드

## Servlet Method

> Servlet: 모든 서블릿이 구현해야 하는 메소드를 정의한 인터페이스
> HttpServlet 클래스만 상속하는 경우에는 반드시 할 필요 없음

| 메소드                                                   | 설명                                                         |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| *void init(ServletConfig config)*                        | 서블릿 컨테이너가 서비스를 시작한 서블릿을 가리킬 때 호출되는 메소드<br />프로그램 실행시 최초 한 번만 실행되기 때문에 서블릿을 초기화하는 생성자 역할을 함 |
| *void destroy()*                                         | 서블릿 컨테이너가 서비스를 종료하는 서블릿을 가리킬 때 호출되는 메소드<br />서버를 끄지 않은 상태에서 서블릿의 내용을 변경하고 저장하면 변경 사항을 반영하기 위해 서블릿을 재시작하려고 종료할 때 실행됨 |
| *void service(ServletRequeset req, ServletResponse res)* | 서블릿 컨테이너가 서블릿이 요청에 응답하도록 허가할 때 호출되는 메소드 |

## HttpServlet Method

> HttpServlet: 웹 사이트에 적합한 HTTP 서블릿을 생성하기 위해
> 상속되어야 하는 추상 클래스
> 최소 하나 이상의 메소드를 오버라이딩 해야함

| 메소드                                                       | 설명                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| *protected void doGet(HttpServletRequest req, HttpServletResponse res)* | service 메소드에 의해 서버가 서블릿에게 GET 요청을 처리하도록 할 때 호출되는 메소드 |
| *protected void doPost(HttpServletRequest req, HttpServletResponse res)* | 위 메소드와 처리 과정은 동일하며 POST 요청을 처리할 때 호출되는 메소드 |
| *protected void service(HttpServletRequest req, HttpServletResponse res)* | public service()로부터 표준 HTTP 요청을 받아서 doXXX 메소드로 요청을 급파함 |
| *void service(HttpServletRequest req, HttpServletResponse res)* | 사용자 요청을 protected service()에 급파                     |

*※ GET방식으로 데이터를 전달하는 경우*
*URI에서 /요청페이지/?매개변수1=값1&매개변수2=값2&... 형식으로 데이터가 전달됨*
*?이하의 데이터를 QueryString이라고 함*
*데이터 양이 적으며 보안에 상관없는 내용을 전달하는 경우 적합*

*※ POST로 데이터를 전달하는 경우*
*URL에 전달 데이터가 출력되지 않으며*
*데이터 양이 많거나 보안이 중요한 내용을 전달하는 경우 적합*

## Servlet 기본 구조

> HelloTest.java 소스 코드

```java
import java.io.IOException;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/HelloTest")
// 서블릿은 HttpServlet을 반드시 상속해야 하고
// 모든 사용자가 접근할 수 있도록 public으로 설정해야 함
public class HelloTest extends HttpServlet {
    // init() 서블릿이 메모리에 올라갈 때 단 한 번만 호출되는 메소드
	public void init(ServletConfig config) throws ServletException {
			// 서블릿 초기화 등 생성자 역할
	}

    // destroy() 서블릿이 메모리에서 해제될 때 호출되는 메소드
	public void destroy() {

	}

    // GET 방식 요청에 대한 응답을 실행하는 메소드
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }
	
    // POST 방식 요청에 대한 응답을 실행하는 메소드
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

	}

}
```

- javax.servlet.ServletConfig: 서블릿 환경설정 관련 클래스
- javax.servlet.ServletException: 서블릿 예외 처리 클래스
- javax.servlet.annotation.WebServlet: 어노테이션 관련 클래스
- javax.servlet.http.HttpServlet: 상속받을 상위 클래스
  HttpServlet 클래스를 상속받기 위해서 import 해주어야 함
- javax.servlet.http.HttpServletRequest:ServletRequest 인터페이스를 상속하며,
HTTP 서블릿에 대한 요청 정보를 제공하는 인터페이스
-  javax.servlet.http.HttpServletResponse: ServletResponse 인터페이스를 상속하며,
응답을 보낼 때 HTTP의 특정 기능을 제공하는 인터페이스
- java.io.IOException: 입출력 예외 처리 클래스,
  데이터 전송 시 입출력을 사용하게 되면 반드시 예외 처리를 해야 함

*※ 서블릿 컨테이너는 HttpServletRequest, HttpServletResponse 객체를 만들고*
*그것을 서블릿의 서비스 메소드들(doGet, doPost, etc)에 인자로 전달함*

## @WebServlet() 어노테이션

> @WebServlet()의 괄호 내부에 실제 경로가 아닌
> "가상 경로"를 상대 경로로 지정해서 보안을 향상시킬 수 있음

- 실제 경로: /HelloTest
- 가상 경로: /test/imsi/HelloTest
- 프로그램 실행시 가상 경로를 포함한 URL이 출력됨

## 예제

> WebContent/sub/send.html 에서 이름과 주소 데이터를 받아서
> src/GetDate.java 서블릿에서 처리하는 예제
>
> WebContent/sub/getdate.jsp 와 비교

### WebContent/sub/send.html

> 사용자의 요청을 받는 html 페이지

```html
<!doctype html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<title>이름, 주소 전달</title>
</head>
<body>
<!-- <form method="post" action="getdate.jsp"> -->
<!-- 서블릿에 데이터 전송시 action="/프로젝트명/실행 서블릿 클래스명" -->
	<form method="get" action="/ServletTest/GetDate">
		이름: <input type="text" name="name" /><br/>
		주소: <input type="text" name="addr" /><br/>
		<input type="submit" value="보내기"/>
	</form>
</body>
</html>
```

### src/GetDate.java

> 사용자의 요청을 처리해서 응답하는 서블릿 파일

```java
import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.*;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;

@WebServlet("/GetDate")
public class GetDate extends HttpServlet {

	// GET 방식으로 요청해도 service() 메소드가 호출됨
	protected void service(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		// service() 호출 확인용
		System.out.println("service 호출");

		// 응답 문서의 타입과 인코딩 지정
		response.setContentType("text/html;charset=utf-8");

		// 데이터 전송을 위한 I/O 클래스, response의 getWriter() 메소드로 객체 반환
		PrintWriter out = response.getWriter();
		out.println("<html><head></head>");
		out.println("<body>");

		// 요청 데이터를 utf-8 인코딩으로 얻어 와서 변수에 저장
		request.setCharacterEncoding("utf-8");
		String name = request.getParameter("name");
		String addr = request.getParameter("addr");

		// 출력
		out.println("이름: " + name + ", 주소: " + addr);

		out.println("</body>");
		out.println("</html>");
	}

}
```

### WebContent/sub/getdate.jsp

> 사용자의 요청을 처리해서 응답하는 JSP 파일

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>응답 페이지</title>
<%
	// 한글 인코딩 설정
	request.setCharacterEncoding("utf-8");
%>
<%
	// send.html에서 전송된 데이터 변수에 저장
	String name = request.getParameter("name");
	String addr = request.getParameter("addr");
    
    // 출력
	out.println("이름: " + name + ", 주소: " + addr);
%>
</head>
<body>

</body>
</html>
```

---

# Response 내장 객체

> 웹 브라우저로 응답항 응답 정보를 가지는 JSP 내장 객체

- 웹 브라우저에 보내는 응답 정보는 HttpServletResponse 객체에 있음
- JSP에서는 response 객체를 이용해서 접근
- 주로 헤더 정보 입력, 리다이렉트 등의 기능을 제공

## Response Method

| 메소드                      | 설명                                                         |
| --------------------------- | ------------------------------------------------------------ |
| void setHeader(name, value) | 헤더 정보의 값을 수정하는 메소드<br />name에 해당하는 헤더 정보를 value로 수정 |
| void setContentType(type)   | 웹 브라우저의 요청 결과로 보일 페이지의 contentType 설정<br />page 디렉티브의 contentType 속성과 같은 역할 |
| void sendRedirect(url)      | 페이지를 이동시키는 메소드<br />url 페이지로 제어가 이동함<br />중간의 로직 처리를 보여줄 필요가 없을 때 사용<br/>ex) 게시글 DB 저장 후 게시글 목록 출력 |

### sendRedirect(url) 처리 과정

1. 웹 브라우저가 a.jsp 페이지 요청
2. a.jsp 페이지의 내용을 수행
3. response.sendRedirect("b.jsp");
   문장을 만나면 프로그램 제어가 b.jsp로 이동
   이 때 위의 문장을 만나기 전까지 실행된 코드 중
   출력될 값을 모두 버린 후에 b.jsp로 이동
4. b.jsp 페이지 수행
5. b.jsp 페이지를 수행한 결과를 웹 브라우저로 응답
   ***b.jsp 페이지의 내용만 처리 결과로 화면에 출력***

---

# Out 내장 객체

> JSP 페이지가 생성한 결과를 웹 브라우저에 전송해 주는 출력 스트림

- JSP가 웹 브라우저로 전송하는 모든 정보가 out 객체를 통해서 전송됨
  모든 정보에는 JSP 스크립트 요소와 HTML, 일반 텍스트 포함
- javax.servelt.jsp.JspWriter 클래스 타입으로 JSP에서는 out 객체로 사용
- 주로 사용되는 메소드는 웹 브라우저 출력에 사용되는 **println()**
- JSP 페이지가 서블릿으로 변환될 때
  < %=문장% > 부분은 out.println(문장)으로 변환되어 실행
- JSP 페이지가 사용하는 출력 버퍼는 out 객체가 내부적으로 사용하는 버퍼

## Out Method

| 메소드                | 설명                                                         |
| --------------------- | ------------------------------------------------------------ |
| *String println(str)* | 주어진 str 값을 웹에 출력<br />줄바꿈은 적용되지 않음        |
| *void clearBuffer()*  | 현재 출력 버퍼에 저장되어 있는 내용을 웹 브라우저에 전송하지 않고 비움 |
| *void flush()*        | 현재 출력 버퍼에 저장되어 있는 내용을 웹 브라우저에 전송하고 비움 |
| *void close()*        | 현재 출력 버퍼에 저장되어 있는 내용을 웹 브라우저에 전송하고 출력 스트림을 닫음 |

---

