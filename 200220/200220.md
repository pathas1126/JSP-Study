# 200220

---

# Template Page

## MVC 기법

> 템플릿 페이지의 이해에 필요한 기법

- MVC 기법이란 Model, View, Controller 로 나누어서 프로그램을 개발하는 것
- Model 모델: 로직을 가지고 있는 부분으로 DB와 연동
  JSP 기반 웹 프로그래밍에서는 보통 자바빈과 로직 클래스가 모델이 됨
- View 뷰: 사용자에게 제공하는 화면으로 UI(User Interface)에 해당
  JSP 기반 웹 프로그래밍에서는 JSP페이지가 뷰가 됨
- Controller 컨트롤러: 뷰와 모델 사이에서 흐름을 제어함
  JSP 기반 웹 프로그래밍에서는 서블릿으로 작성

## Template Page 개요

- 뷰를 모듈화하는 것이 템플릿 페이지
- 실질적인 메인 페이지라고 할 수 있음
- JSP 페이지를 모듈화하면 유지 보수를 쉽게 할 수 있음
- 메인페이지에서 forward 액션 태그로 템플릿 페이지를 포워딩
- 템플릿 페이지에서 include 액션 태그를 사용해서 페이지 모듈들을 로드함

## 예제

> 템플릿의 기본 구조를 알아보는 예제
>
> index.jsp 메인페이지에서 indexControl.jsp로 기본 데이터를 전달하고
> indexControl.jsp에서 template.jsp로 index.jsp의 데이터와
> top.jsp에서 넘어오는 데이터를 전달함
>
> template.jsp 템플릿 페이지에서 동적으로 컨텐츠 관리

### Webcontent/index.jsp

> 메인 페이지
> indexControl로 포워딩시키는 역할을 하며
> 처음에 출력될 페이지의 데이터를 전송함

```jsp
<!-- 포워딩용 페이지 -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Index.jsp</title>
</head>
<body>
	<!-- indexControl.jsp로 포워딩 -->
	<!-- 매개변수 전달 ?CONTROL="intro"&PAGE_NUM="01"-->
	<jsp:forward page="/view/indexControl.jsp">

		<jsp:param name="CONTROL" value="intro" />
		<jsp:param name="PAGE_NUM" value="01" />

	</jsp:forward>
	<!-- 액션 태그 내부에 주석을 사용하면 에러 발생 -->
</body>
</html>
```

### Webcontent/view/indexControl.jsp

> 데이터를 처리하는 페이지
> 처음에는 index.jsp의 데이터를 전달 받고
> 그 이후에는 top.jsp에서 전달 받는 데이터를
> template.jsp로 전달함

```jsp
<!-- 데이터 전달용 페이지 -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%-- 디자인을 하지 않는 경우 html 코드는 필요 없음 --%>

<%
	// /view/indexControl.jsp?CONTROL=C_value&PAGE_NUM=N_value
	String CONTROL = null;
	String PAGE_NUM = null;
	
	// 데이터를 전달받을 때는 예외 처리를 해야 함
	try {
        // 파라미터의 데이터를 변수에 저장
		CONTROL = request.getParameter("CONTROL");
		PAGE_NUM = request.getParameter("PAGE_NUM");
        
        // 확인용 콘솔 출력
		System.out.println("CONTROL: " + CONTROL + ", PAGE_NUM: " + PAGE_NUM);

		// 매개변수를 전달 받지 못한 경우 임의로 변수 값 설정
		if (CONTROL.equals(null)) {
			CONTROL = "intro";
		}
		if (PAGE_NUM.equals(null)) {
			PAGE_NUM = "01";
		}

	} catch (Exception e) {
		System.out.println(e);
	}
%>

	<!-- 템플릿 페이지에 표현식으로 value 값을 동적으로 전달 -->
<jsp:forward page="/template/template.jsp">
	<jsp:param name="CONTROL" value="<%=CONTROL%>" />
	<jsp:param name="PAGE_NUM" value="<%=PAGE_NUM%>" />
</jsp:forward>
```

### Webcontent/template/template.jsp

> indexControl.jsp에서 전달받은 데이터를 가지고
> 동적으로 화면에 출력될 내용을 정의하는 페이지

```jsp
<!-- 템플릿 페이지(실질적인 메인 페이지) -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%
	// indexControl.jsp로부터 데이터 수신
	String CONTROL = request.getParameter("CONTROL");
	String PAGE_NUM = request.getParameter("PAGE_NUM");
	System.out.println("CONTROL: " + CONTROL + ", PAGE_NUM: " + PAGE_NUM);

	/* CONTROL, PAGE_NUM 값을 이용해서 실제 경로 작성 */	 
	// 왼쪽 메뉴
	String left = "/module/" + CONTROL + "Left.jsp";

	// 본문 내용
	String content = "/view/" + CONTROL + "_" + PAGE_NUM + ".jsp";
%>
</head>
<body>

	<center>
		<!-- 페이지 전체를 table로 구성 -->
		<table width="600" height="600" border="1" cellpadding="2"
			cellspacing="0">
			
			<!--  상단 메뉴 -->
			<tr height="50" width="100%">
				<td colspan="2">
				<jsp:include page="/module/top.jsp"	flush="false" />
				</td>
			</tr>

			<!--  왼쪽 메뉴, 메인 컨텐츠 -->
			<tr height="300" width="100%">

				<!--  왼쪽 메뉴 -->
				<td width="150" valing="top">
				<jsp:include page="<%=left%>" flush="false" />
				</td>

				<!-- 메인 컨텐츠 -->
				<td>
				<jsp:include page="<%=content%>" flush="false" />
				</td>
			</tr>

			<!--  하단 메뉴 -->
			<tr height="45">
				<td colspan="2">
				<jsp:include page="/module/bottom.jsp"	flush="false" />
				</td>
			</tr>
			
		</table>
	</center>
	
</body>
</html>
```

### Webcontent/top.jsp

> 상단 메뉴 파일
> 각각의 링크에서 indexControl.jsp에 쿼리스트링으로 데이터 전달

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
	
<!-- CSS -->
<style>
#container {
	display: flex;
	justify-content: space-around;
	content-align: center;
}
</style>

<!-- indexControl.jsp에 CONTROL 값과 PAGE_NUM 값을 넘겨줌 -->
<!-- 파일 경로에 웹 애플리케이션 이름까지 작성해야 함 -->
<div id="container">
	<div>
		<a
			href="/JspStudy_200220/view/indexControl.jsp?CONTROL=intro&PAGE_NUM=01">
			회사소개 
		</a>
	</div>
	<div>
		<a
			href="/JspStudy_200220/view/indexControl.jsp?CONTROL=product&PAGE_NUM=01">
			제품소개 
		</a>
	</div>
	<div>
		<a
			href="/JspStudy_200220/view/indexControl.jsp?CONTROL=research&PAGE_NUM=01">
			연구개발
		</a>
	</div>
	<div>
		<a
			href="/JspStudy_200220/view/indexControl.jsp?CONTROL=faq&PAGE_NUM=01">
			묻고답하기
		</a>
	</div>
	<div>
		<a
			href="/JspStudy_200220/view/indexControl.jsp?CONTROL=file&PAGE_NUM=01">
			자료실 
		</a>
	</div>
</div>
```

### 결과

#### 전체 파일 구조

![200220 MD 템플릿 0](C:\webtest\capture\JSP\MD\200220 MD 템플릿 0.png)

#### 처음 출력되는 화면

![200220 MD 템플릿 1](C:\webtest\capture\JSP\MD\200220 MD 템플릿 1.png)

#### 제품 소개에서 출력되는 화면

![200220 MD 템플릿 2](C:\webtest\capture\JSP\MD\200220 MD 템플릿 2.png)

---

# JavaBean 자바빈

> 웹상에서 불러다 사용하는 자바 클래스(DTO)
> DTO: Data Transfer Object

## JavaBean 개요

- 자바빈은 자바로 작성된 컴포넌트들을 일반적으로 일컫는 말
- 자바는 프로그램 기본 단위가 클래스이며
  자바빈은 클래스들이 복합적으로 이루어진 구조
- 자바빈은 자바 언어의 프로그램 작성 규칙과 문법을 따름

## JavaBean 등장 배경

- JSP 페이지에는 디자인과 로직 코드가 같이 기술되기 때문에
  한눈에 이해하기 어려움 
- 디자인과 로직이 공존하는 코드는 재사용하기가 어려움
- 따라서 디자인과 로직 코드가 복잡하게 구성되는 것을 가능한 피하고
  JSP 페이지의 로직 부분을 분리해서 코드를 재사용함으로써
  프로그램의 효율을 높이기 위해 자바빈 사용

## JavaBean 작성

> Java의 클래스를 만드는 것과 같은 규칙을 가짐

- 이클립스에서 자바빈을 생성할 때는 src폴더에 Class 파일 생성
  ↔ 서블릿은 Servlet 파일
- main 메소드를 작성하지 않음
- 패키지 이름으로 기능별로 자바빈 파일 분류
- 파일 이름은 일반적으로 ~DTO.java로 작성
- JSP 페이지에서 객체를 생성하는 가장 보편적인 방법

### JavaBean 전체 구조

```java
package packageName; // 생략 가능
import packageName.className;	// 생략 가능
class className {
    // property
    private 자료형 변수명;
    
    // Setter Method
    public void setXXX(Parameter param){
        // Java code
    }
    
    // Getter Method
    public 자료형 getXXX(){
        return 변수명;
    }
    
}	// 필수 정의, 생략 불가
```

### JavaBean Class 구조

```java
접근 제어자 [키워드] class 클래스명{}
```

- Access Modifier 접근 제어자: public, private, default(아무것도 없는 경우)가 올 수 있는데, 자바빈을 작성할 때는 주로 **public** 사용
  웹에서는 불특정 다수의 접근을 허용해야 하기 때문에 public 사용
- Keyword 키워드: final, abstract, static 등이 있지만 **자바빈 클래스에서는 사용 하지 않음**
- Class name 클래스명: 첫 글자는 대문자로 나머지는 소문자로 작성
  단어가 이어지는 경우에는 단어의 첫 글자를 대문자로 작성

### Property

> 데이터를 저장하기 위한 멤버 변수

- 자바빈의 프로퍼티(property)는 값을 저장하기 위한 멤버 필드로
  캡슐화를 위해 private 접근 제어자를 사용함
- 프로퍼티는 자바의 멤버 변수와 동일한 역할이며
  JSP 페이지의 내용을 DB에 저장하거나
  DB에 저장된 내용을 JSP페이지에 표시할 때 중간 데이터 저장소로 사용
- 프로퍼티에 private 접근 제어자가 부여되기 때문에
  외부에서 프로퍼티에 접근하기 위해서는 Setter/Getter 메소드가 필요

### Setter/Getter Method

#### Setter

> 프로퍼티의 값을 설정하는 메소드

- 외부에서 접근이 가능해야 하기 때문에 public 접근 제어자 사용
- 반환값이 없기 때문에 메소드명 앞에 void를 작성하며
- 필드값 변경을 위한 매개변수를 전달 받음  
- 메소드의 이름은 setXxx로 지정, Xxx는 프로퍼티의 이름

#### Getter

> 프로퍼티의 값을 반환하는 메소드

- Setter와 마찬가지로 public 접근 제어자 사용
- 반환값에 맞는 자료형을 메소드명 앞에 작성
- 메소드의 이름은 getXxx로 지정

## 예제

> ① form.jsp에 데이터를 입력하면 bean2.jsp에서 변수에 저장
> ② 이름과 주소 데이터를 저장하고 반환하는 src/BeanDTO.java 자바빈 작성
> ③ bean2.jsp에서 test.BeanDTO import 후 BeanDTO 객체를 생성해서
> 이름과 주소를 객체에 저장하고 반환하도록 함
> ④ BeanDTO 자바빈 클래스를 사용하면 이름과 주소를 처리하는 모든 페이지에서 동일한 프로퍼티와 Setter, Getter 메소드를 사용할 수 있게 됨

### form.jsp

```jsp
<!-- 사용자로부터 데이터를 입력받는 form -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JavaBean 입력 폼</title>
</head>
<body>
<!-- name값은 빈즈 클래스의 프로퍼티 이름과 동일해야 함 -->
<form action="bean2.jsp" method="post">
	이름: <input type="text" name="name" /> <br />
	주소: <input type="text" name="addr" /> <br />
	<input type="submit" value="전송" />
</form>

</body>
</html>
```

### bean2.jsp

```jsp
<!-- page 디렉티브에서 BeanDTO 클래스 import, 패키지명.클래스명-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8" import="test.BeanDTO"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%
	// 한글 처리
	request.setCharacterEncoding("utf-8");

	// form.jsp로부터 전송된 데이터 변수에 저장
	String name = request.getParameter("name");
	String addr = request.getParameter("addr");
	System.out.println("name: " + name + ", addr: " + addr);

	// JavaBean 객체 생성
	BeanDTO bd = new BeanDTO();

	// 프로퍼티 개수만큼 Setter 메소드 호출
	bd.setName(name);
	bd.setAddr(addr);

	// 필요에 따라 Getter 메소드 호출
	out.println("이름: " + bd.getName());
	out.println("주소: " + bd.getAddr());
%>
</head>
<body>
    <!-- 표현식으로도 호출 가능 -->
	<h2>
		이름: <%=bd.getName()%>
	</h2>
	<h2>
		주소: <%=bd.getAddr()%>
	</h2>
</body>
</html>
```

### src/BeanDTO.java

```java
// 패키지명
package test;

// 클래스는 반드시 public 접근 제어자 사용
public class BeanDTO {

	// property, 반드시 private 선언
	private String name;
	private String addr;

	// Setter, public 지정
	public void setName(String name) {
		this.name = name;
	}

	public void setAddr(String addr) {
		this.addr = addr;
	}

	// Getter, public 지정
	public String getName() {
		return name;
	}

	public String getAddr() {
		return addr;
	}
}
```

### 결과

![200219 MD_JavaBean 1](C:\webtest\capture\JSP\MD\200219 MD_JavaBean 1.png)

---

# JavaBean과 연동하는 액션 태그

> JSP에서 정의된 자바빈 객체에 접근하기 위한 액션 태그

| 액션 태그                                                  | 설명                                      |
| ---------------------------------------------------------- | ----------------------------------------- |
| < jsp:useBean id="..." class="..." scope="..."/ >          | 자바빈 객체 생성                          |
| < jsp:setProperty name="..." property="..." value="..."/ > | 생성된 자바빈 객체의 프로퍼티 값 저장     |
| < jsp:getProperty name="..." property="..."/ >             | 생성된 자바빈 객체의 프로퍼티 값을 얻어냄 |

- 위의 액션 태그들이 JSP페이지에서
  자바빈 객체를 생성하고 Setter, Getter 메소드를 사용하는 과정을 대체함
- 자바빈과 연동되는 태그이기 때문에 자바빈 파일이 작성되어 있어야 함
- 입력 데이터의 양이 많을 때는 자바빈 클래스를 직접 쓰기 보다
  액션 태그를 사용하는 것이 권장됨
  setProperty의 property 값을 *로 설정

## useBean 액션 태그

> 자바빈 객체를 생성하는데 사용하는 액션 태그

```jsp
<jsp:useBean id="beanName" class="beanClassName" scope="scope"/> 
```

- id 속성: 생성될 자바빈 객체(인스턴스)의 이름을 지정, 필수 속성
- class 속성: 객체가 생성될 자바빈 클래스명을 기술하는 곳
  패키지명을 포함한 자바 클래스의 풀네임 기술, 필수 속성
  import가 되는 것이기 때문에 JSP페이지에서 따로 import 할 필요 없음
- scope 속성: 자바빈 객체의 유효 범위로 자바빈 객체가 공유되는 범위 지정
  scope 속성 값으로 내장 객체 page, request, session, application 지정 가능
  생략 가능하며 생략시 기본값은 page

## setProperty 액션 태그

> 자바빈 객체의 프로퍼티 값을 저장하기 위해 사용하는 액션 태그

```jsp
<jsp:setProperty name="beanName" property="propName" value="value"/>
```

- name 속성: 자바빈 객체의 이름 지정, 필수 속성
- property 속성: 프로퍼티 이름 지정, 필수 속성
  **property 속성값을 *(애스테리스크)로 주면 모든 프로퍼티 값이 한 번에 저장됨**
  form에서 넘어오는 파라미터의 이름, 개수가
  자바빈 프로퍼티의 이름, 개수와 정확히 일치해야 함
  → 액션 태그를 사용하는 결정적인 이유
- value 속성: 프로퍼티에 저장할 값 지정, 생략 가능
property 값이 *일 때도 생략
- 자바빈 클래스의 Setter 메소드 호출

## getProperty 액션 태그

> 자바빈 객체에 저장된 프로퍼티 값을 얻어낼 때 사용하는 액션 태그

```jsp
<jsp:getProperty name="beanName" property="propName"/>
```

- name 속성: 자바빈 객체 이름 지정, 필수 속성
- property 속성: 값을 얻어올 프로퍼티 이름 지정, 필수 속성
- 자바빈 클래스의 Getter 메소드 호출

## 예제

> ① form3.jsp에 데이터를 입력하고 bean3.jsp에서 변수에 저장
> ② 이름과 주소 데이터를 저장하고 반환하는 src/BeanDTO.java 자바빈 작성
> ③ bean3.jsp에서 자바빈 연동 액션 태그 사용

### form3.jsp

> 데이터 입력 JSP 페이지

```jsp
<!-- 사용자로부터 데이터를 입력받는 form3.jsp -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JavaBean 입력 폼</title>
</head>
<body>
<!-- name값은 자바빈 클래스의 프로퍼티 이름과 동일해야 함 -->
<form action="bean3.jsp" method="post">
	이름: <input type="text" name="name" /> <br />
	주소: <input type="text" name="addr" /> <br />
	<input type="submit" value="전송" />
</form>

</body>
</html>
```

### bean3.jsp

> 데이터 수신 후 액션 태그를 사용해서 자바빈과 연동

```jsp
<!-- useBean 태그의 class에서 BeanDTO와 연결되기 때문에 import 생략 가능 -->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<%
	// 한글 처리
	request.setCharacterEncoding("utf-8");

	// form3.jsp로부터 전송된 데이터 변수에 저장
	String name = request.getParameter("name");
	String addr = request.getParameter("addr");
	System.out.println("name: " + name + ", addr: " + addr);
%>
</head>
<body>
	<!-- useBean 액션 태그로 bd 객체 생성 -->
	<jsp:useBean id="bd" class="test.BeanDTO" scope="page" />
	
	<!-- setProperty 액션 태그로 bd 객체의 모든 프로퍼티에 값 저장 -->
	<jsp:setProperty name="bd" property="*"/>
		
	<%--
	위의 액션태그를 풀어쓰면 아래와 같음
	<jsp:setProperty name="bd" property="name" value="<%=name%>" />
	<jsp:setProperty name="bd" property="addr" value="<%=addr%>" />
	--%>

	<!-- getProperty 액션 태그로 bd 객체에 저장한 값 반환 -->
	<h2>
		이름: <jsp:getProperty name="bd" property="name" />
	</h2>
	<h2>
		주소: <jsp:getProperty name="bd" property="addr" />
	</h2>
		
	<!-- 표현식으로도 호출 가능 -->
	<b><%=bd.getAddr()%>의 <%=bd.getName()%>님 잘 오셨습니다.</b>
</body>
</html>
```

### src/BeanDTO.java

> BeanDTO 클래스가 작성되어 있는 파일

```java
// 패키지 작성
package test;

// 클래스는 반드시 public 접근 제어자 사용
public class BeanDTO {

	// property, 반드시 private 선언
    // 변수명은 form3.jsp의 input 태그 name 값과 동일해야 함
	private String name;
	private String addr;

	// Setter, public 지정
	public void setName(String name) {
		this.name = name;
	}

	public void setAddr(String addr) {
		this.addr = addr;
	}

	// Getter, public 지정
	public String getName() {
		return name;
	}

	public String getAddr() {
		return addr;
	}
}
```

### 결과

![200219 MD_useBean 결과](C:\webtest\capture\JSP\MD\200219 MD_useBean 결과.png)